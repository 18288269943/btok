\begin{appendix}{Б}{обязательное}{Файловая система}
\label{FILES}

\hiddensection{Общие сведения}

В соответствии с~\cite{APDU} прикладные программы и данные КТ должны 
интерпретироваться как файлы следующих типов: 

\begin{enumerate}
\item
DF (dedicated file)~--- назначенный файл. 
Предназначен для объявления прикладных программ и/или объединения файлов в 
группы. DF может являться родительским для других файлов.

\item
EF (elementary file)~--- элементарный файл. 
Предназначен для хранения данных. 
EF не может быть родительским для других файлов.
\end{enumerate}

Имеются две категории элементарных файлов:
\begin{itemize}
\item[--] 
внутренние, используемые КТ для целей управления и контроля;  
\item[--]
рабочие, предназначенные для хранения данных, к которым можно обращаться извне.
\end{itemize}                                                            
                  
При выполнении команд КТ может обращаться к DF и EF как явно, так и неявно 
(автоматически). Для явного обращения используется один из следующих 
методов: 
\begin{enumerate}
\item
Выбор по имени. Используется только для DF. Имя представляет собой строку 
октетов, длина которой не превышает 16. Прикладным программам КТ назначаются  
специальные идентификаторы (AID). Такой идентификатор может использоваться 
как имя DF прикладной программы. 

\item
Выбор по идентификатору файла. Идентификатор файла (FID) состоит из двух октетов. 
Некоторые идентификаторы зарезервированы. Например, 
идентификатор $\hex{3F00}$ назначается обязательному DF, 
который является корневым в иерархической структуре файлов и 
который обозначается MF (master file/мастер-файл). 

\if0
\item
Выбор по пути. Путь представляет собой объединение идентификаторов файлов. Путь 
начинается с идентификатора приложения (MF для абсолютного пути и текущего DF 
для относительного пути) и заканчивается идентификатором самого файла. Между 
двумя данными идентификаторами путь содержит идентификаторы промежуточных 
DF (если они есть). 

\item
Выбор по короткому идентификатору. Используется только для EF. Короткий
идентификатор файла (SFID) представляет собой 5 бит и может принимать значения
от 1 до 30. В~\cite{APDU} накладываются ограничения на использование данного
идентификатора.
\fi
\end{enumerate}

\hiddensection{Прикладная программа eID}

Прикладной программе eID назначается AID $\hex{D11200020022654F0701}$. 
Он получен в результате корректировки префикса в кодовом представлении 
идентификатора \verb|id-eID|.
%
% AID = RID (5 октетов) || RIX (5 октетов)
%   RID = D112 (правила ISO 7816-5, by) || 00 (standard) 02 (std) 00 (stb)
%   RIX = 22 (34) 65 (101) 4F (79) 07 (apps) 01 (eID)

Прикладная программа eID поддерживает 22 группы 
данных (DG1--DG22) с атрибутами владельца КТ (см.~\ref{DATA.DG}). 
%
Группы данных размещаются в EF, описанных в таблице~\ref{Table.FILES.DG}. 
%
В этой и следующей таблицах R обозначает право доступа на чтение, 
W~--- на запись, R/W~--- на чтение и запись.

Файлы для групп данных DG1--DG11, DG15, DG16 являются обязательными:
они должны формироваться при создании файловой системы КТ. 
Остальные файлы являются необязательными.  
 
\begin{table}[thb]
\caption{Группы данных eID}
\label{Table.FILES.DG}
\begin{tabular}{|c|c|c|c|}
\hline
Группа & Содержание & FID & Доступ\\
\hline
\hline
DG1 & Серийный номер КТ & 
$\texttt{0101}_{16}$ & R\\
DG2 & Страна, выпустившая КТ & 
$\texttt{0102}_{16}$ & R\\
DG3 & Дата окончания действия КТ & 
$\texttt{0103}_{16}$ & R\\
DG4 & Имя & 
$\texttt{0104}_{16}$ & R\\
DG5 & Фамилия & 
$\texttt{0105}_{16}$ & R\\
DG6 & Отчество & 
$\texttt{0106}_{16}$ & R\\
DG7 & Идентификационный номер & 
$\texttt{0107}_{16}$ & R\\
DG8 & Дата рождения & 
$\texttt{0108}_{16}$ & R\\
DG9 & Место рождения & 
$\texttt{0109}_{16}$ & R\\
DG10 & Гражданство & 
$\texttt{010A}_{16}$ & R\\
DG11 & Пол & 
$\texttt{010B}_{16}$ & R\\
DG12 & Дополнительные данные для чтения & 
$\texttt{010C}_{16}$ & R\\
DG13 & 
%ФИО владельца, данное ему при рождении & 
--- &
$\texttt{010D}_{16}$ & R\\
DG14 & Изображение ручной подписи & 
$\texttt{010E}_{16}$ & R\\
DG15 & Дата выпуска КТ & 
$\texttt{010F}_{16}$ & R\\
DG16 & Орган, выдавший КТ &  
$\texttt{0110}_{16}$ & R\\
DG17 & 	Адрес постоянного места жительства & 
$\texttt{0111}_{16}$ & R/W\\
DG18 & 	Код региона & 
$\texttt{0112}_{16}$ & R/W\\
DG19 & 	
%Вид на жительство I & 
--- &
$\texttt{0113}_{16}$ & R/W\\
DG20 & 	
%Вид на жительство II & 
--- &
$\texttt{0114}_{16}$ & R/W\\
DG21 & 	Номер телефона & 
$\texttt{0115}_{16}$ & R/W\\
DG22 & 	Адрес электронной почты & 
$\texttt{0116}_{16}$ & R/W\\
\hline
\end{tabular}
\end{table}

\hiddensection{Прикладная программа eSign}

Прикладной программе eSign назначается AID~$\hex{D11200020022654F0702}$. 
Он получен в результате корректировки префикса в кодовом представлении 
идентификатора \verb|id-eSign|.

Прикладная программа eSign поддерживает чтение и обновление 
элементарных файлов, описанных в таблице~\ref{Table.FILES.EFSIGN}.

С каждым из 6 личных ключей с идентификаторами~$\hex{01}$--$\hex{03}$,
$\hex{11}$--$\hex{13}$ (см. таблицу~\ref{Table.Oper.KeyRef}) 
связаны два элементарных файла. 
В первом хранится сертификат соответствующего открытого ключа 
(см.~\ref{OBJ.Certs}), во втором~--- хэш-значение открытого ключа.
%
Хэш-значение рассчитывается по правилам, заданным в СТБ 34.101.78
относительно расширения \texttt{SubjectKeyIdentifier} сертификата.
%
Хэш-значение состоит из 20 или 32 октетов.

Файл с сертификатом записывается извне КП или терминалом.
Файл с хэш-значением либо записывается извне, либо формируется 
автоматически во время генерации пары ключей 
(см.~\ref{Oper.Descr.GenKeys}).

\begin{table}[H]
\caption{Элементарные файлы eSign}
\label{Table.FILES.EFSIGN}
\begin{tabular}{|l|c|c|c|}
\hline
Содержание & FID & \multicolumn{2}{|c|}{Доступ}\\
\cline{3-4}
&& PS & AS \\
\hline
\hline
Объект \texttt{Name} (см.~\ref{Oper.Seq.GeKeySetCert}) & 
$\texttt{5101}_{16}$ & R & R/W \\
%\hline
Сертификат открытого ключа с идентификатором $\hex{0X}$ & 
$\texttt{520X}_{16}$ & R/W & -- \\
%\hline
Сертификат открытого ключа с идентификатором $\hex{1X}$ & 
$\texttt{521X}_{16}$ & -- & R/W \\
%\hline
Хэш-значение открытого ключа с идентификатором $\hex{0X}$ & 
$\texttt{530X}_{16}$ & R/W & -- \\
%\hline
Хэш-значение открытого ключа с идентификатором $\hex{1X}$ & 
$\texttt{531X}_{16}$ & -- & R/W \\
\hline
\end{tabular}
\end{table}

Файлы для объекта \texttt{Name} и ключей с идентификаторами $\hex{01}$, $\hex{11}$
являются обязательными: они должны формироваться при создании файловой 
системы КТ (но могут быть первоначально пустыми). 
Остальные файлы являются необязательными.

\end{appendix}